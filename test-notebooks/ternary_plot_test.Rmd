---
title: "Ternary Plot Test"
output: html_notebook
---

## Libraries
```{r}

# Get from CRAN first
install.packages(c("tidyverse", "nycflights13", "Lahman"))

# Update from GitHub
devtools::install_github(
  "tidyverse/tibble", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/ggplot2", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/readr", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/readxl", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/tidyr", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/purrr", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/dplyr", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/stringr", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/forcats", 
  force = TRUE,
  build_vignettes = TRUE)
devtools::install_github(
  "tidyverse/tidyverse",
  force = TRUE,
  build_vignettes = TRUE)

# library(magrittr)
# library(dfstools)
# library(DT)

```

## Get data
```{r}
# playerbox <- playerboxscore("~/Dropbox/16-17-player-data/season-player-feed-04-12-2017.xlsx")
playerbox <- playerboxscore("~/Dropbox/17-wnba-player/wnba-season-player-feed-05-28-2017.xlsx")
```

## EDA
```{r}
boxplot(playerbox$dkfp)$stats
boxplot(playerbox$dkfp ~ playerbox$own_team)$stats
```


## Run model
```{r}
arch_search <- archetype_search(playerbox)
screeplot(arch_search)
arch_model <- archetypal_analysis(playerbox)
player_table <- arch_model$player_table
archetypes <- arch_model$archetypes
player_table %<>% dplyr::filter(Bench < 0.99)
save(arch_model, archetypes, player_table, playerbox, file = "~/Projects/mastering-dfs-analytics-package/test-notebooks/ternary-data.RData")
dtx <- player_table
dtx[, 4:7] <- round(dtx[, 4:7], 4)
DT::datatable(dtx)
dtx %>% dplyr::filter(Player == "Mason Plumlee" | Player == "Jusuf Nurkic") %>% knitr::kable()
```

## Generate team plots
```{r}
teams <- sort(unique(as.character(player_table$Team)))
for (t in teams) {
  team_data <- player_table %>% 
    dplyr::filter(Team == t) %>% dplyr::top_n(12, Overall) %>% dplyr::arrange(desc(Overall))
  ternary_plot(
    player_table = team_data, 
    plot_title = t, 
    top_label = "Back", 
    left_label = "Front") %>% print()
  filename <- paste(t, "pdf", sep = ".")
  ggtern::ggsave(filename, width = 11, height = 8.5, units = "in")
}
```
